
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Kon-Tiki Expedition (1947): Video summary &#8212; Weather observations from marine expeditions</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Kon-Tiki Expedition (1947): Route" href="route.html" />
    <link rel="prev" title="Kon-Tiki Conversion script" href="conversion.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="route.html" title="Kon-Tiki Expedition (1947): Route"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="conversion.html" title="Kon-Tiki Conversion script"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Expeditions</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../ToDo.html" >Expeditions To Do</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="Kon-Tiki.html" accesskey="U">Kon-Tiki Expedition (1947)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Kon-Tiki Expedition (1947): Video summary</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="kon-tiki-expedition-1947-video-summary">
<h1>Kon-Tiki Expedition (1947): Video summary<a class="headerlink" href="#kon-tiki-expedition-1947-video-summary" title="Permalink to this heading">Â¶</a></h1>
<center>
<table><tr><td><center>
<iframe src="https://player.vimeo.com/video/292918898?title=0&byline=0&portrait=0" width="795" height="448" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></center></td></tr>
<tr><td><center>Route (left) and observations (right), from the Kon-Tiki. Compared with the observations coverage, and ensemble reconstructions, for 20CRv3.</center></td></tr>
</table>
</center><div class="line-block">
<div class="line"><br /></div>
</div>
<p>The map on the left shows the route of the Kon-Tiki (red and grey dots) and the locations of all the other pressure observations available to 20CR3 (yellow dots). The graphs on the right show the observations made by the Kon-Tiki (red and black dots), and co-located reconstructions from the 20CR3 ensemble (blue dots).</p>
<p>Based on the detailed figures for: <a class="reference internal" href="route.html"><span class="doc">Route</span></a>, <a class="reference internal" href="pressures.html"><span class="doc">SLP</span></a>, <a class="reference internal" href="sea_temperatures.html"><span class="doc">air temperature</span></a>, <a class="reference internal" href="sea_temperatures.html"><span class="doc">SST</span></a>, <a class="reference internal" href="wind_speed.html"><span class="doc">wind speed</span></a> &amp; <a class="reference internal" href="wind_direction.html"><span class="doc">wind direction</span></a>. See those for the necessary data collection and pre-processing.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Script to make an individual frame - takes year, month, day, and hour as command-line options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># US region weather plot </span>
<span class="c1"># Compare observations from 20CRV3 and Kon-Tiki</span>
<span class="c1"># Video version.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">import</span> <span class="nn">iris</span>
<span class="kn">import</span> <span class="nn">iris.analysis</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_agg</span> <span class="kn">import</span> \
             <span class="n">FigureCanvasAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>

<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>

<span class="kn">import</span> <span class="nn">Meteorographica</span> <span class="k">as</span> <span class="nn">mg</span>
<span class="kn">import</span> <span class="nn">IRData.twcr</span> <span class="k">as</span> <span class="nn">twcr</span>
<span class="kn">import</span> <span class="nn">IMMA</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Get the datetime to plot from commandline arguments</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--year&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--month&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Integer month&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--day&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Day of month&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--hour&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Time of day (0 to 23.99)&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--opdir&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory for output files&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/images/Kon-Tiki&quot;</span> <span class="o">%</span> \
                                           <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SCRATCH&#39;</span><span class="p">),</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">opdir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">opdir</span><span class="p">)</span>

<span class="n">dte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                      <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hour</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>


<span class="c1"># HD video size 1920x1080</span>
<span class="n">aspect</span><span class="o">=</span><span class="mf">16.0</span><span class="o">/</span><span class="mf">9.0</span>
<span class="n">fig</span><span class="o">=</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.8</span><span class="o">*</span><span class="n">aspect</span><span class="p">,</span><span class="mf">10.8</span><span class="p">),</span>  <span class="c1"># Width, Height (inches)</span>
           <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
           <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
           <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
           <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">subplotpars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">tight_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">canvas</span><span class="o">=</span><span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span> <span class="p">:</span> <span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sans-serif&#39;</span> <span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;size&#39;</span>   <span class="p">:</span> <span class="mi">14</span><span class="p">}</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font</span><span class="p">)</span>

<span class="c1"># US-centred projection</span>
<span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span><span class="n">pole_longitude</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">scale</span><span class="o">=</span><span class="mi">60</span>
<span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">scale</span><span class="o">*-</span><span class="mi">1</span><span class="o">*</span><span class="n">aspect</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">aspect</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">scale</span><span class="o">*-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="p">]</span>

<span class="c1"># Map plot on the left</span>
<span class="n">ax_map</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.485</span><span class="p">,</span><span class="mf">0.98</span><span class="p">],</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
<span class="n">ax_map</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax_map</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>

<span class="c1"># Background, grid and land </span>
<span class="n">ax_map</span><span class="o">.</span><span class="n">background_patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">mg</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">add_grid</span><span class="p">(</span><span class="n">ax_map</span><span class="p">,</span><span class="n">sep_minor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">sep_major</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">land_img</span><span class="o">=</span><span class="n">ax_map</span><span class="o">.</span><span class="n">background_img</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;GreyT&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">)</span>

<span class="c1"># Add the observations from Reanalysis</span>
<span class="n">obs</span><span class="o">=</span><span class="n">twcr</span><span class="o">.</span><span class="n">load_observations_fortime</span><span class="p">(</span><span class="n">dte</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="s1">&#39;4.5.1&#39;</span><span class="p">)</span>
<span class="n">mg</span><span class="o">.</span><span class="n">observations</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax_map</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="c1"># Plot the current position</span>
<span class="n">obs</span><span class="o">=</span><span class="n">IMMA</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span>
                       <span class="s1">&#39;../../../../imma/Kon-Tiki_1947.imma&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LON&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LI&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ob_dte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">ob_dte</span><span class="o">&lt;</span><span class="n">dte</span><span class="p">:</span>
           <span class="n">rp</span><span class="o">=</span><span class="n">ax_map</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                              <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LON&#39;</span><span class="p">]),</span>
                                              <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]))</span>
           <span class="n">ax_map</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">rp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">rp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span>
                                                <span class="n">radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                                <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                                                <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                                                <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                                <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ob_dte</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">&lt;</span><span class="n">dte</span> <span class="ow">and</span> 
        <span class="n">ob_dte</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">&gt;</span><span class="n">dte</span><span class="p">):</span>
           <span class="n">rp</span><span class="o">=</span><span class="n">ax_map</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                              <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LON&#39;</span><span class="p">]),</span>
                                              <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ob</span><span class="p">[</span><span class="s1">&#39;LAT&#39;</span><span class="p">]))</span>
           <span class="n">ax_map</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">rp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">rp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span>
                                                <span class="n">radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                                <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                                                <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                                                <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                                <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>

<span class="n">mg</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_label</span><span class="p">(</span><span class="n">ax_map</span><span class="p">,</span>
              <span class="p">(</span><span class="s1">&#39;</span><span class="si">%04d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> 
               <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">hour</span><span class="p">)),</span>
              <span class="n">facecolor</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">(),</span>
              <span class="n">x_fraction</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
              <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>


<span class="c1"># Add the pressure timeseries</span>
<span class="n">rdata</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_prmsl.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SLP&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;SLP&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rdata_values</span><span class="o">=</span><span class="p">[</span><span class="n">value</span><span class="o">/</span><span class="mf">100.0</span> <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">rdata</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">ax_slp</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.44</span><span class="p">,</span><span class="mf">0.18</span><span class="p">])</span>
<span class="c1"># Axes ranges from data</span>
<span class="n">ax_slp</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
             <span class="nb">max</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">ax_slp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
             <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ob_values</span><span class="p">)</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax_slp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSLP (hPa)&#39;</span><span class="p">)</span>
<span class="n">ax_slp</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">t_jitter</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rdata</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dte</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ensemble</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="o">/</span><span class="mf">100.0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span> <span class="c1"># in hPa</span>
    <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_jitter</span><span class="p">]</span>
    <span class="n">ax_slp</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">ensemble</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SLP&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SLP&#39;</span><span class="p">]</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SLP&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">indices_past</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">))</span> <span class="k">if</span> <span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dte</span><span class="p">]</span>
<span class="n">ob_values_shifted</span><span class="o">=</span><span class="p">[</span><span class="n">value</span><span class="o">-</span><span class="mi">12</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ob_values</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices_past</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">ax_slp</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ob_values_shifted</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax_slp</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                   <span class="p">[</span><span class="n">ob_values_shifted</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Add the AT timeseries</span>
<span class="n">rdata</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_air.2m.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;AT&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;AT&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rdata_values</span><span class="o">=</span><span class="p">[</span><span class="n">value</span><span class="o">-</span><span class="mf">273.15</span> <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">rdata</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">ax_at</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span><span class="mf">0.61</span><span class="p">,</span><span class="mf">0.44</span><span class="p">,</span><span class="mf">0.18</span><span class="p">])</span>
<span class="c1"># Axes ranges from data</span>
<span class="n">ax_at</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
             <span class="nb">max</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">ax_at</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
             <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">ax_at</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AT (C)&#39;</span><span class="p">)</span>
<span class="n">ax_at</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">t_jitter</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rdata</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dte</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ensemble</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="o">-</span><span class="mf">273.15</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span> <span class="c1"># in hPa</span>
    <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_jitter</span><span class="p">]</span>
    <span class="n">ax_at</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">ensemble</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;AT&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;AT&#39;</span><span class="p">]</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;AT&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">indices_past</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">))</span> <span class="k">if</span> <span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dte</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices_past</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">ax_at</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax_at</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Add the SST timeseries</span>
<span class="n">rdata</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_air.sfc.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SST&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;SST&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rdata_values</span><span class="o">=</span><span class="p">[</span><span class="n">value</span><span class="o">-</span><span class="mf">273.15</span> <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">rdata</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">ax_sst</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span><span class="mf">0.42</span><span class="p">,</span><span class="mf">0.44</span><span class="p">,</span><span class="mf">0.18</span><span class="p">])</span>
<span class="c1"># Axes ranges from data</span>
<span class="n">ax_sst</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
             <span class="nb">max</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">ax_sst</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
             <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">ax_sst</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SST (C)&#39;</span><span class="p">)</span>
<span class="n">ax_sst</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">t_jitter</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rdata</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dte</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ensemble</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="o">-</span><span class="mf">273.15</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span> <span class="c1"># in hPa</span>
    <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_jitter</span><span class="p">]</span>
    <span class="n">ax_sst</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">ensemble</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SST&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SST&#39;</span><span class="p">]</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;SST&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">indices_past</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">))</span> <span class="k">if</span> <span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dte</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices_past</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">ax_sst</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax_sst</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Add the wind speed timeseries</span>
<span class="n">rdata_u</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_uwnd.10m.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">rdata_v</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_vwnd.10m.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="c1"># Convert u and v to speed</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])):</span>
        <span class="n">rdata_u</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">rdata_v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rdata_values</span><span class="o">=</span><span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">rdata_u</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">ax_w</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span><span class="mf">0.23</span><span class="p">,</span><span class="mf">0.44</span><span class="p">,</span><span class="mf">0.18</span><span class="p">])</span>
<span class="c1"># Axes ranges from data</span>
<span class="n">ax_w</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
             <span class="nb">max</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">ax_w</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
             <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ob_values</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">rdata_values</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax_w</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Wind speed (m/s)&#39;</span><span class="p">)</span>
<span class="n">ax_w</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">t_jitter</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rdata_u</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dte</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ensemble</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
    <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_jitter</span><span class="p">]</span>
    <span class="n">ax_w</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">ensemble</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">indices_past</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">))</span> <span class="k">if</span> <span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dte</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices_past</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">ax_w</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax_w</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>


<span class="c1"># Add the wind direction timeseries</span>
<span class="n">rdata_u</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_uwnd.10m.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="n">rdata_v</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../20CRv3_comparisons/20CRv3_vwnd.10m.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="c1"># Convert u and v to speed</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])):</span>
        <span class="n">rdata_u</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="mf">180.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span>
                          <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">rdata_v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">rdata_u</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
                          <span class="o">+</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rdata_values</span><span class="o">=</span><span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">rdata_u</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">ax_d</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.55</span><span class="p">,</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.44</span><span class="p">,</span><span class="mf">0.19</span><span class="p">])</span>
<span class="c1"># Axes ranges from data</span>
<span class="n">ax_d</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
             <span class="nb">max</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">)</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">ax_d</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">91</span><span class="p">,</span><span class="mi">271</span><span class="p">)</span>
<span class="n">ax_d</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span>
           <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">271</span><span class="p">,</span><span class="mi">45</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)))</span>
<span class="n">ax_d</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
           <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedFormatter</span><span class="p">((</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;NW&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;SE&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;SW&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">)))</span>
<span class="n">ax_d</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Wind direction&#39;</span><span class="p">)</span>
<span class="c1">#ax_d.get_xaxis().set_visible(False)</span>
<span class="n">t_jitter</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata_u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rdata_u</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">dte</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ensemble</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
    <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_jitter</span><span class="p">]</span>
    <span class="n">ax_d</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">ensemble</span><span class="p">,</span>
                    <span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ob_dates</span><span class="o">=</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">],</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]))</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">ob_values</span><span class="o">=</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> 
                  <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> 
                <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;YR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;MO&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;DY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                 <span class="n">o</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)])</span>
<span class="n">indices_past</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ob_dates</span><span class="p">))</span> <span class="k">if</span> <span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dte</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices_past</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">ax_d</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_past</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax_d</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">ob_dates</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                   <span class="p">[</span><span class="n">ob_values</span><span class="p">[</span><span class="n">indices_past</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
                    <span class="mi">50</span><span class="p">,</span>
                    <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="c1"># Color</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Output as png</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/V3vobs_Kon-Tiki_</span><span class="si">%04d%02d%02d%02d%02d</span><span class="s1">.png&#39;</span> <span class="o">%</span> 
               <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">opdir</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                           <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hour</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span>
</pre></div>
</div>
<p>To make the video, it is necessary to run the script above hundreds of times - giving an image for every 15-minute period. The best way to do this is system dependent - the script below does it on the Met Office SPICE cluster - it will need modification to run on any other system. (Could do this on a single PC, but it will take many hours).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Make all the individual frames for a movie</span>
<span class="c1">#  run the jobs on SPICE.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">max_jobs_in_queue</span><span class="o">=</span><span class="mi">500</span>
<span class="c1"># Where to put the output files</span>
<span class="n">opdir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/slurm_output&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SCRATCH&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">opdir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">opdir</span><span class="p">)</span>

<span class="n">start_day</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1947</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span>  <span class="mi">0</span><span class="p">)</span>
<span class="n">end_day</span>  <span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1947</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>

<span class="c1"># Function to check if the job is already done for this timepoint</span>
<span class="k">def</span> <span class="nf">is_done</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">):</span>
    <span class="n">op_file_name</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/images/Kon-Tiki/&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;V3vobs_Kon-Tiki_</span><span class="si">%04d%02d%02d%02d%02d</span><span class="s2">.png&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;SCRATCH&#39;</span><span class="p">),</span>
                            <span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">),</span>
                                        <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="o">%</span><span class="mi">1</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">op_file_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="n">current_day</span><span class="o">=</span><span class="n">start_day</span>
<span class="k">while</span> <span class="n">current_day</span><span class="o">&lt;=</span><span class="n">end_day</span><span class="p">:</span>
    <span class="n">queued_jobs</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">&#39;squeue --user hadpb&#39;</span><span class="p">,</span>
                                         <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">max_new_jobs</span><span class="o">=</span><span class="n">max_jobs_in_queue</span><span class="o">-</span><span class="n">queued_jobs</span>
    <span class="k">while</span> <span class="n">max_new_jobs</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">current_day</span><span class="o">&lt;=</span><span class="n">end_day</span><span class="p">:</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;multirun.slm&quot;</span><span class="p">,</span><span class="s2">&quot;w+&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#!/bin/ksh -l</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#SBATCH --output=</span><span class="si">%s</span><span class="s1">/Kon-Tiki_frame_</span><span class="si">%04d%02d%02d%02d</span><span class="s1">.out</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                   <span class="p">(</span><span class="n">opdir</span><span class="p">,</span>
                    <span class="n">current_day</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                    <span class="n">current_day</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">hour</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#SBATCH --qos=normal</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#SBATCH --ntasks=4</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#SBATCH --ntasks-per-core=1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#SBATCH --mem=40000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#SBATCH --time=10</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">fraction</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_done</span><span class="p">(</span><span class="n">current_day</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                           <span class="n">current_day</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">hour</span><span class="o">+</span><span class="n">fraction</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">cmd</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;./KT_V3vobs.py --year=</span><span class="si">%d</span><span class="s2"> --month=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="s2">&quot; --day=</span><span class="si">%d</span><span class="s2"> --hour=</span><span class="si">%f</span><span class="s2"> &amp;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                   <span class="n">current_day</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                   <span class="n">current_day</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">current_day</span><span class="o">.</span><span class="n">hour</span><span class="o">+</span><span class="n">fraction</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;wait</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">current_day</span><span class="o">=</span><span class="n">current_day</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">max_new_jobs</span><span class="o">=</span><span class="n">max_new_jobs</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">rc</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;sbatch multirun.slm&#39;</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="s1">&#39;multirun.slm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To turn the thousands of images into a movie, use <a class="reference external" href="http://www.ffmpeg.org">ffmpeg</a></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ffmpeg<span class="w"> </span>-r<span class="w"> </span><span class="m">24</span><span class="w"> </span>-pattern_type<span class="w"> </span>glob<span class="w"> </span>-i<span class="w"> </span>Kon-Tiki/<span class="se">\*</span>.png<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-c:v<span class="w"> </span>libx264<span class="w"> </span>-threads<span class="w"> </span><span class="m">16</span><span class="w"> </span>-preset<span class="w"> </span>slow<span class="w"> </span>-tune<span class="w"> </span>animation<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-profile:v<span class="w"> </span>high<span class="w"> </span>-level<span class="w"> </span><span class="m">4</span>.2<span class="w"> </span>-pix_fmt<span class="w"> </span>yuv420p<span class="w"> </span>-crf<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-c:a<span class="w"> </span>copy<span class="w"> </span>Kon-Tiki.mp4
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/The_Water_Bucket_by_Carroll_Jones_III.jpg" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../instructions.html">How to use this dataset</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../voyages/Cook.html">James Cookâs Expeditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voyages/Arctic.html">Arctic Expeditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voyages/Antarctic.html">Antarctic Expeditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voyages/Other.html">Other Expeditions</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../ToDo.html">Expeditions To Do</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Authors and acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uses.html">Uses of this data</a></li>
</ul>
<h3><a href="https://github.com/oldweather/Expeditions">Get the data</a></h3>

<ul>
<li><a href="https://github.com/oldweather/Expeditions"
           rel="nofollow">Github repository</a></li>
<li><a href="https://github.com/oldweather/Expeditions/archive/master.zip"
           rel="nofollow">Zip file</a></li>
</ul>

<h3>Found a bug, or have a suggestion?</h3>

Please <a href="https://github.com/oldweather/Expeditions/issues/new">raise an issue</a>.
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="route.html" title="Kon-Tiki Expedition (1947): Route"
             >next</a></li>
        <li class="right" >
          <a href="conversion.html" title="Kon-Tiki Conversion script"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Expeditions</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../ToDo.html" >Expeditions To Do</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="Kon-Tiki.html" >Kon-Tiki Expedition (1947)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Kon-Tiki Expedition (1947): Video summary</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>